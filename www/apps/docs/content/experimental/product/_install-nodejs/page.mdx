import { Table } from "docs-ui"

export const metadata = {
  title: `Install Product Module in Node.js-Based Application`,
}

# {metadata.title}

In this document, you’ll learn how to setup and use the Product Module in a Node.js based application. This includes a Node.js server or a serverless applications like Next.js.

<Note type="check">

- [Node.js v16+](https://nodejs.org/en/download)
- [PostgreSQL database](https://www.postgresql.org/docs/current/sql-createdatabase.html). You can use an existing Medusa database, or set up a new PostgreSQL database.

</Note>

## Install Package

In your Node.js-based applications, such as a Next.js application, install the Product Module with the following command:

```bash npm2yarn
npm install @medusajs/product
```

---

## Add Database Configuration

Add the following environment variable to your application:

```bash
POSTGRES_URL=<DATABASE_URL>
```

<Table>
  <Table.Header>
    <Table.Row>
      <Table.HeaderCell>Environment Variable Name</Table.HeaderCell>
      <Table.HeaderCell>Description</Table.HeaderCell>
      <Table.HeaderCell>Required</Table.HeaderCell>
      <Table.HeaderCell>Default</Table.HeaderCell>
    </Table.Row>
  </Table.Header>
  <Table.Body>
    <Table.Row>
      <Table.Cell>
      
      `POSTGRES_URL`
      
      </Table.Cell>
      <Table.Cell>
      
      A string indicating the database connection URL of the format `postgres://[user][:password]@[host][:port]/[dbname]`. Learn more about the connection URL format in [this guide](../../../references/medusa_config/interfaces/medusa_config.ConfigModule/page.mdx#database_url).
      
      </Table.Cell>
      <Table.Cell>
      
      Yes
      
      </Table.Cell>
      <Table.Cell>
      
      \-
      
      </Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell>
      
      `POSTGRES_SCHEMA`
      
      </Table.Cell>
      <Table.Cell>
      
      A string indicating the PostgreSQL schema to use.
      
      </Table.Cell>
      <Table.Cell>
      
      No
      
      </Table.Cell>
      <Table.Cell>
      
      `public`
      
      </Table.Cell>
    </Table.Row>
    <Table.Row>
      <Table.Cell>
      
      `POSTGRES_DRIVER_OPTIONS`
      
      </Table.Cell>
      <Table.Cell>
      
      A stringified JSON object indicating the PostgreSQL options to use. The JSON object is then parsed to be used as a JavaScript object.
      
      </Table.Cell>
      <Table.Cell>
      
      No
      
      </Table.Cell>
      <Table.Cell>
      
      `{"connection":{"ssl":false}}` for local PostgreSQL databases, and `{"connection":{"ssl":{"rejectUnauthorized":false}}}` for remote databases.
      The database is considered local if `POSTGRES_URL` includes `localhost`.
      
      </Table.Cell>
    </Table.Row>
  </Table.Body>
</Table>

### Run Database Migrations

<Note>

You can skip this step if you're using an existing Medusa database.

</Note>

Migrations are used to create your database schema. To run migrations, add in your `package.json` the following scripts:

```json
"scripts": {
  //...other scripts
  "product:migrations:run": "medusa-product-migrations-up",
  "product:seed": "medusa-product-seed ./seed-data.js"
}
```

The first command runs the migrations, and the second command seeds your database with demo products optionally.

However, you’d need the following seed file added to the root of your project directory:

<Details summaryContent="Seed File">

    ```js
    const productCategoriesData = [
      {
        id: "category-0",
        name: "category 0",
        parent_category_id: null,
      },
      {
        id: "category-1",
        name: "category 1",
        parent_category_id: "category-0",
      },
      {
        id: "category-1-a",
        name: "category 1 a",
        parent_category_id: "category-1",
      },
      {
        id: "category-1-b",
        name: "category 1 b",
        parent_category_id: "category-1",
        is_internal: true,
      },
      {
        id: "category-1-b-1",
        name: "category 1 b 1",
        parent_category_id: "category-1-b",
      },
    ]
    
    const productsData = [
      {
        id: "test-1",
        title: "product 1",
        status: "published",
        descriptions: "Lorem ipsum dolor sit amet, consectetur.",
        tags: [
          {
            id: "tag-1",
            value: "France",
          },
        ],
        categories: [
          {
            id: "category-0",
          },
        ],
      },
      {
        id: "test-2",
        title: "product",
        status: "published",
        descriptions: "Lorem ipsum dolor sit amet, consectetur.",
        tags: [
          {
            id: "tag-2",
            value: "Germany",
          },
        ],
        categories: [
          {
            id: "category-1",
          },
        ],
      },
    ]
    
    const variantsData = [
      {
        id: "test-1",
        title: "variant title",
        sku: "sku 1",
        product: { id: productsData[0].id },
        inventory_quantity: 10,
      },
      {
        id: "test-2",
        title: "variant title",
        sku: "sku 2",
        product: { id: productsData[1].id },
        inventory_quantity: 10,
      },
    ]
    
    module.exports = {
      productCategoriesData,
      productsData,
      variantsData,
    }
    ```

</Details>

Then, run the commands you added to migrate the database schema and optionally seed data:

```bash npm2yarn
npm run product:migrations:run
# optionally
npm run product:seed
```

---

## Next.js Application: Adjust Configurations

The Product Module uses dependencies that aren’t Webpack optimized. Since Next.js uses Webpack for compilation, you need to add the Product Module as an external dependency.

To do that, add the `serverComponentsExternalPackages` option in `next.config.js`:

```js title="next.config.js"
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    serverComponentsExternalPackages: [
      "@medusajs/product",
    ],
  },
}

module.exports = nextConfig
```

---

## Example Usage

To use the main service of the Product Module, import and use the `initialize` method from `@medusajs/product`.

For example:

```ts
import { NextResponse } from "next/server"
import { 
  initialize as initializeProductModule,
} from "@medusajs/product"

export async function GET(request: Request) {
  const productModuleService = await initializeProductModule()

  return NextResponse.json({
    products: await productModuleService.list(),
  })
}
```
