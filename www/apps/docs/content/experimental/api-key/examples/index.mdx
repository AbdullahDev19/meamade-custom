import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"

# Examples of the API Key Module

In this guide, youâ€™ll find common examples of how you can use the API Key Module in your application.

## Create an API Key

<Tabs groupId="app-type" isCodeTabs={true}>
  <TabItem label="Medusa API Router" value="medusa">

  ```ts
  import { MedusaRequest, MedusaResponse } from "@medusajs/medusa"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  export async function POST(
    request: MedusaRequest,
    response: MedusaResponse
  ) {
    const apiKeyModuleService: IApiKeyModuleService =
      request.scope.resolve(ModuleRegistrationName.API_KEY)

    const apiKey = await apiKeyModuleService.create({
      title: "Publishable API key",
      type: "publishable",
      created_by: "user_123",
    })

    response.json({
      api_key: apiKey,
    })
  }
  ```

  </TabItem>
  <TabItem label="Next.js App Router" value="nextjs">

  ```ts
  import { NextResponse } from "next/server"

  import {
    initialize as initializeApiKeyModule,
  } from "@medusajs/api-key"

  export async function POST(request: Request) {
    const apiKeyModuleService = await initializeApiKeyModule()

    const apiKey = await apiKeyModuleService.create({
      title: "Publishable API key",
      type: "publishable",
      created_by: "user_123",
    })

    return NextResponse.json({
      api_key: apiKey,
    })
  }
  ```

  </TabItem>
</Tabs>

---

## List API Keys

<Tabs groupId="app-type" isCodeTabs={true}>
  <TabItem label="Medusa API Router" value="medusa">

  ```ts
  import { MedusaRequest, MedusaResponse } from "@medusajs/medusa"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  export async function GET(
    request: MedusaRequest,
    response: MedusaResponse
  ) {
    const apiKeyModuleService: IApiKeyModuleService =
      request.scope.resolve(ModuleRegistrationName.API_KEY)

    response.json({
      api_keys: await apiKeyModuleService.list(),
    })
  }
  ```

  </TabItem>
  <TabItem label="Next.js App Router" value="nextjs">

  ```ts
  import { NextResponse } from "next/server"

  import {
    initialize as initializeApiKeyModule,
  } from "@medusajs/api-key"

  export async function GET(request: Request) {
    const apiKeyModuleService = await initializeApiKeyModule()

    return NextResponse.json({
      api_keys: await apiKeyModuleService.list(),
    })
  }
  ```

  </TabItem>
</Tabs>

---

## Revoke an API Key

<Tabs groupId="app-type" isCodeTabs={true}>
  <TabItem label="Medusa API Router" value="medusa">

  ```ts
  import { MedusaRequest, MedusaResponse } from "@medusajs/medusa"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  export async function POST(
    request: MedusaRequest,
    response: MedusaResponse
  ) {
    const apiKeyModuleService: IApiKeyModuleService =
      request.scope.resolve(ModuleRegistrationName.API_KEY)

    const revokedKey = await apiKeyModuleService.revoke(
      request.params.id
    )

    response.json({
      api_key: revokedKey,
    })
  }
  ```

  </TabItem>
  <TabItem label="Next.js App Router" value="nextjs">

  ```ts
  import { NextResponse } from "next/server"

  import {
    initialize as initializeApiKeyModule,
  } from "@medusajs/api-key"

  type ContextType = {
    params: {
      id: string
    }
  }

  export async function POST(
    request: Request,
    { params }: ContextType
  ) {
    const apiKeyModuleService = await initializeApiKeyModule()

    const revokedKey = await apiKeyModuleService.revoke(params.id)

    return NextResponse.json({
      api_key: revokedKey,
    })
  }
  ```

  </TabItem>
</Tabs>

---

## Verify Token

<Tabs groupId="app-type" isCodeTabs={true}>
  <TabItem label="Medusa API Router" value="medusa">

  ```ts
  import { MedusaRequest, MedusaResponse } from "@medusajs/medusa"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  export async function POST(
    request: MedusaRequest,
    response: MedusaResponse
  ) {
    const apiKeyModuleService: IApiKeyModuleService =
      request.scope.resolve(ModuleRegistrationName.API_KEY)

    const authenticatedToken =
      await apiKeyModuleService.authenticate(request.params.id)

    response.json({
      is_authenticated: !!authenticatedToken,
    })
  }
  ```

  </TabItem>
  <TabItem label="Next.js App Router" value="nextjs">

  ```ts
  import { NextResponse } from "next/server"

  import {
    initialize as initializeApiKeyModule,
  } from "@medusajs/api-key"

  type ContextType = {
    params: {
      id: string
    }
  }

  export async function POST(
    request: Request,
    { params }: ContextType
  ) {
    const apiKeyModuleService = await initializeApiKeyModule()

    const authenticatedToken =
      await apiKeyModuleService.authenticate(request.params.id)

    return NextResponse.json({
      is_authenticated: !!authenticatedToken,
    })
  }
  ```

  </TabItem>
</Tabs>

---

## Roll API Key

<Tabs groupId="app-type" isCodeTabs={true}>
  <TabItem label="Medusa API Router" value="medusa">

  ```ts
  import { MedusaRequest, MedusaResponse } from "@medusajs/medusa"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  export async function POST(
    request: MedusaRequest,
    response: MedusaResponse
  ) {
    const apiKeyModuleService: IApiKeyModuleService =
      request.scope.resolve(ModuleRegistrationName.API_KEY)

    const revokedKey = await apiKeyModuleService.revoke(
      request.params.id
    )

    const newKey = await apiKeyModuleService.create({
      title: revokedKey.title,
      type: revokedKey.type,
      created_by: revokedKey.created_by,
    })

    response.json({
      api_key: newKey,
    })
  }
  ```

  </TabItem>
  <TabItem label="Next.js App Router" value="nextjs">

  ```ts
  import { NextResponse } from "next/server"

  import {
    initialize as initializeApiKeyModule,
  } from "@medusajs/api-key"

  type ContextType = {
    params: {
      id: string
    }
  }

  export async function POST(
    request: Request,
    { params }: ContextType
  ) {
    const apiKeyModuleService = await initializeApiKeyModule()

    const revokedKey = await apiKeyModuleService.revoke(params.id)

    const newKey = await apiKeyModuleService.create({
      title: revokedKey.title,
      type: revokedKey.type,
      created_by: revokedKey.created_by,
    })

    return NextResponse.json({
      api_key: newKey,
    })
  }
  ```

  </TabItem>
</Tabs>

---

## More Examples

The [module interface reference](../../../references/api_key/interfaces/api_key.IApiKeyModuleService.mdx) provides a reference to all the methods available for use with examples for each.
