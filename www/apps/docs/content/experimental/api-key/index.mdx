import Tabs from "@theme/Tabs"
import TabItem from "@theme/TabItem"

# API Key Module

The API Key Module is the `@medusajs/api-key` NPM package that provides API-key-related features in your Medusa and Node.js applications.

---

## Features

### API Key Types and Management

Store and manage API keys in your store. You can create both publishable and secret API keys for different use cases, such as:

- Publishable API Key associated with resources like sales channels.
- Authentication token for admin users to access Admin API Routes.
- Password reset tokens when a user or customer requests to reset their password.

```ts
const pubApiKey = await apiKeyModuleService.create({
  title: "Publishable API key",
  type: "publishable",
  created_by: "user_123"
})

const secretApiKey = await apiKeyModuleService.create({
  title: "Authentication Key",
  type: "secret",
  created_by: "user_123"
})
```

### Token Verification

Verify tokens of secret API keys to authenticate users or actions, such as verifying a password reset token.

```ts
const authenticatedToken =
    await apiKeyModuleService.authenticate("sk_123")

if (!authenticatedToken) {
  console.error("Couldn't verify token")
} else {
  console.log("Token verified successfully!")
}
```

### Revoke Keys

Revoke keys to disable their use permenantly.

```ts
const revokedKey = await apiKeyModuleService.revoke("apk_1")
```

### Roll API Keys

Roll API keys by revoking a key then re-creating it.

```ts
const revokedKey = await apiKeyModuleService.revoke("apk_1")

const newKey = await apiKeyModuleService.create({
  title: revokedKey.title,
  type: revokedKey.type,
  created_by: revokedKey.created_by
})
```

---

## How to Use API Key Module's Service

You can use the API Key Module's main service by resolving from the dependency container the resource `ModuleRegistrationName.API_KEY` imported from `@medusajs/modules-sdk`.

For example:

<Tabs groupId="resource-type" isCodeTabs={true}>
  <TabItem label="API Route" value="api-route" attributes={{
    title: "src/api/store/custom/route.ts"
  }}>

  ```ts
  import { MedusaRequest, MedusaResponse } from "@medusajs/medusa"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  export async function GET(
    request: MedusaRequest,
    response: MedusaResponse
  ): Promise<void> {
    const apiKeyModuleService: IApiKeyModuleService =
      request.scope.resolve(ModuleRegistrationName.API_KEY)

    response.json({
      api_keys: await apiKeyModuleService.list(),
    })
  }
  ```

  </TabItem>
  <TabItem label="Subscriber" value="subscribers" attributes={{
    title: "src/subscribers/custom-handler.ts"
  }}>

  ```ts
  import { SubscriberArgs } from "@medusajs/medusa"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  export default async function subscriberHandler({
    container,
  }: SubscriberArgs<Record<string, string>>) {
    const apiKeyModuleService: IApiKeyModuleService =
      container.resolve(ModuleRegistrationName.API_KEY)

    const apiKeys = await apiKeyModuleService.list()
  }
  ```

  </TabItem>
  <TabItem label="Workflow Step" value="workflow-step" attributes={{
    title: "src/workflows/hello-world/step1.ts"
  }}>

  ```ts
  import { createStep } from "@medusajs/workflows-sdk"
  import { IApiKeyModuleService } from "@medusajs/types"
  import { ModuleRegistrationName } from "@medusajs/modules-sdk"

  const step1 = createStep("step-1", async (_, context) => {
    const apiKeyModuleService: IApiKeyModuleService =
      context.container.resolve(
        ModuleRegistrationName.API_KEY
      )
    const apiKeys = await apiKeyModuleService.list()
  })
  ```

  </TabItem>
</Tabs>
